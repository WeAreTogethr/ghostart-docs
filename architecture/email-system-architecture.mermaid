graph TD
    subgraph Frontend
        A[User Settings Page]
        B[Email Preferences UI]
    end

    subgraph Email System
        C[Resend API]
        D[Email Templates]
        E[Email Queue Manager]
    end

    subgraph Queue Layer
        F[Redis Queue]
        G[Scheduled Jobs]
    end

    subgraph Database
        H[Supabase DB]
        I[Email Logs]
        J[User Preferences]
    end

    subgraph Background Tasks
        K[Next.js API Routes]
        L[Email Workers]
    end

    A --> B
    B --> J
    K --> E
    E --> C
    E --> D
    E --> F
    F --> L
    L --> C
    L --> I
    L --> J
    G --> F
    
    classDef frontend fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef email fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef queue fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef db fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef tasks fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    
    class A,B frontend
    class C,D,E email
    class F,G queue
    class H,I,J db
    class K,L tasks
